@model CommunityCar.Domain.Entities.Identity.Users.ApplicationUser
@using Microsoft.AspNetCore.Identity
@using CommunityCar.Domain.Entities.Identity.Users
@using CommunityCar.Domain.Enums.Identity.Users
@inject UserManager<ApplicationUser> UserManager
@{
    ViewData["Title"] = Model.FullName ?? Model.UserName;

    var rankBadge = Model.Rank switch
    {
        UserRank.Master => new { Color = "bg-danger", Icon = "fa-star-of-life", Name = "Grand Master" },
        UserRank.Moderator => new { Color = "bg-dark", Icon = "fa-shield-halved", Name = "Moderator" },
        UserRank.Author => new { Color = "bg-info", Icon = "fa-pen-nib", Name = "Author" },
        UserRank.Reviewer => new { Color = "bg-success", Icon = "fa-star", Name = "Reviewer" },
        UserRank.Expert => new { Color = "bg-warning", Icon = "fa-crown", Name = "Expert" },
        _ => new { Color = "bg-secondary", Icon = "fa-user", Name = "Standard" }
    };

    var (nextThreshold, progress) = Model.Rank switch
    {
        UserRank.Moderator => (10000, (int)((Model.Points - 8000) / 20.0)),
        UserRank.Author => (8000, (int)((Model.Points - 5000) / 30.0)),
        UserRank.Reviewer => (5000, (int)((Model.Points - 3000) / 20.0)),
        UserRank.Expert => (3000, (int)((Model.Points - 1000) / 20.0)),
        UserRank.Standard => (1000, (int)(Model.Points / 10.0)),
        _ => (0, 100)
    };
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-sm border-0 overflow-hidden">
                <div class="card-header bg-primary text-white p-4 text-center">
                    <div class="avatar-circle mx-auto mb-3 bg-white text-primary d-flex align-items-center justify-content-center fw-bold display-4 shadow" style="width: 100px; height: 100px; border-radius: 50%;">
                        @(Model.FullName?.Substring(0, Math.Min(2, Model.FullName.Length)).ToUpper() ?? Model.UserName?.Substring(0, 2).ToUpper() ?? "??")
                    </div>
                    <h2 class="h3 mb-1">@ViewData["Title"]</h2>
                    
                    <div class="mb-2">
                        <span class="badge @rankBadge.Color text-white shadow-sm px-3 py-2">
                            <i class="fas @rankBadge.Icon me-1"></i> @rankBadge.Name
                        </span>
                    </div>

                    @if (Model.Rank < UserRank.Master)
                    {
                        <div class="mx-auto mt-2" style="max-width: 200px;">
                            <div class="d-flex justify-content-between x-small mb-1 opacity-75">
                                <span>Next Rank</span>
                                <span>@Model.Points / @nextThreshold</span>
                            </div>
                            <div class="progress" style="height: 4px; background: rgba(255,255,255,0.2);">
                                <div class="progress-bar bg-white" role="progressbar" style="width: @progress%" aria-valuenow="@progress" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    }

                    <p class="mb-0 mt-3 opacity-75 small">@Model.Email</p>
                </div>
                <div class="card-body p-4">
                    <div class="row text-center mb-4">
                        <div class="col-3">
                            <h5 class="fw-bold text-primary mb-0">@Model.Questions.Count</h5>
                            <small class="text-muted">Questions</small>
                        </div>
                        <div class="col-3 border-start">
                            <h5 class="fw-bold text-primary mb-0">@Model.Answers.Count</h5>
                            <small class="text-muted">Answers</small>
                        </div>
                        <div class="col-3 border-start">
                            <h5 class="fw-bold text-primary mb-0">@Model.Points</h5>
                            <small class="text-muted">Points</small>
                        </div>
                        <div class="col-3 border-start">
                            <h5 class="fw-bold text-primary mb-0">@Model.CreatedAt.Year</h5>
                            <small class="text-muted">Joined</small>
                        </div>
                    </div>

                    <hr class="my-4">

                    <h5 class="fw-bold mb-3">About</h5>
                    <p class="text-muted">
                        @(string.IsNullOrWhiteSpace(Model.Bio) ? "This user hasn't written a bio yet." : Model.Bio)
                    </p>
                    
                    @if (Model.Id.ToString() == UserManager.GetUserId(User))
                    {
                        <div class="text-center mt-4">
                            <a asp-area="Identity" asp-controller="Account" asp-action="Manage" class="btn btn-outline-primary">
                                <i class="fas fa-edit me-2"></i>Edit Profile
                            </a>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>
