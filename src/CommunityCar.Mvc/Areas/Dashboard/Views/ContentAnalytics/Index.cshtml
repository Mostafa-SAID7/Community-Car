@model CommunityCar.Mvc.Areas.Dashboard.ViewModels.ContentAnalyticsViewModel
@{
    ViewData["Title"] = "Content Analytics";
}

<div class="container-fluid py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2><i class="fas fa-chart-line me-2"></i>Content Analytics</h2>
            <p class="text-muted mb-0">Track content performance and engagement metrics</p>
        </div>
        <div class="btn-group" role="group">
            <a asp-action="Index" asp-route-period="7days" class="btn btn-sm @(Model.Period == "7days" ? "btn-primary" : "btn-outline-primary")">7 Days</a>
            <a asp-action="Index" asp-route-period="30days" class="btn btn-sm @(Model.Period == "30days" ? "btn-primary" : "btn-outline-primary")">30 Days</a>
            <a asp-action="Index" asp-route-period="90days" class="btn btn-sm @(Model.Period == "90days" ? "btn-primary" : "btn-outline-primary")">90 Days</a>
            <a asp-action="Index" asp-route-period="1year" class="btn btn-sm @(Model.Period == "1year" ? "btn-primary" : "btn-outline-primary")">1 Year</a>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Total Content</h6>
                            <h3 class="mb-0">@(Model.TotalQuestions + Model.TotalPosts + Model.TotalEvents + Model.TotalNews + Model.TotalGuides + Model.TotalReviews)</h3>
                            <small class="text-success">
                                <i class="fas fa-arrow-up"></i> @(Model.NewQuestions + Model.NewPosts + Model.NewEvents + Model.NewNews + Model.NewGuides + Model.NewReviews) new
                            </small>
                        </div>
                        <div class="text-primary">
                            <i class="fas fa-file-alt fa-3x opacity-25"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Total Views</h6>
                            <h3 class="mb-0">@Model.TotalViews.ToString("N0")</h3>
                            <small class="text-muted">Across all content</small>
                        </div>
                        <div class="text-info">
                            <i class="fas fa-eye fa-3x opacity-25"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Total Engagement</h6>
                            <h3 class="mb-0">@Model.TotalComments.ToString("N0")</h3>
                            <small class="text-muted">Comments & Answers</small>
                        </div>
                        <div class="text-success">
                            <i class="fas fa-comments fa-3x opacity-25"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="text-muted mb-1">Total Likes</h6>
                            <h3 class="mb-0">@Model.TotalLikes.ToString("N0")</h3>
                            <small class="text-muted">Posts & Guides</small>
                        </div>
                        <div class="text-danger">
                            <i class="fas fa-heart fa-3x opacity-25"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Type Distribution -->
    <div class="row g-4 mb-4">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="fas fa-chart-area me-2"></i>Content Growth Over Time</h5>
                </div>
                <div class="card-body">
                    <canvas id="contentGrowthChart" height="80"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="fas fa-chart-pie me-2"></i>Content Distribution</h5>
                </div>
                <div class="card-body">
                    <canvas id="contentDistributionChart"></canvas>
                    <div class="mt-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-circle text-primary"></i> Questions</span>
                            <strong>@Model.TotalQuestions</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-circle text-success"></i> Posts</span>
                            <strong>@Model.TotalPosts</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-circle text-info"></i> Events</span>
                            <strong>@Model.TotalEvents</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-circle text-warning"></i> News</span>
                            <strong>@Model.TotalNews</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-circle text-secondary"></i> Guides</span>
                            <strong>@Model.TotalGuides</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span><i class="fas fa-circle text-danger"></i> Reviews</span>
                            <strong>@Model.TotalReviews</strong>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Type Breakdown -->
    <div class="row g-4 mb-4">
        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0"><i class="fas fa-question-circle text-primary me-2"></i>Questions</h6>
                        <span class="badge bg-primary">@Model.TotalQuestions</span>
                    </div>
                    <div class="progress mb-2" style="height: 8px;">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: @Model.QuestionsPercentage.ToString("F1")%" aria-valuenow="@Model.QuestionsPercentage" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between text-muted small">
                        <span>@Model.QuestionsPercentage.ToString("F1")% of total</span>
                        <span>+@Model.NewQuestions new</span>
                    </div>
                    @if (Model.AvgViewsPerQuestion > 0)
                    {
                        <div class="mt-2 text-muted small">
                            <i class="fas fa-eye me-1"></i>Avg @Model.AvgViewsPerQuestion.ToString("F0") views
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0"><i class="fas fa-edit text-success me-2"></i>Posts</h6>
                        <span class="badge bg-success">@Model.TotalPosts</span>
                    </div>
                    <div class="progress mb-2" style="height: 8px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: @Model.PostsPercentage.ToString("F1")%" aria-valuenow="@Model.PostsPercentage" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between text-muted small">
                        <span>@Model.PostsPercentage.ToString("F1")% of total</span>
                        <span>+@Model.NewPosts new</span>
                    </div>
                    @if (Model.AvgViewsPerPost > 0)
                    {
                        <div class="mt-2 text-muted small">
                            <i class="fas fa-eye me-1"></i>Avg @Model.AvgViewsPerPost.ToString("F0") views
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0"><i class="fas fa-calendar text-info me-2"></i>Events</h6>
                        <span class="badge bg-info">@Model.TotalEvents</span>
                    </div>
                    <div class="progress mb-2" style="height: 8px;">
                        <div class="progress-bar bg-info" role="progressbar" style="width: @Model.EventsPercentage.ToString("F1")%" aria-valuenow="@Model.EventsPercentage" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between text-muted small">
                        <span>@Model.EventsPercentage.ToString("F1")% of total</span>
                        <span>+@Model.NewEvents new</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0"><i class="fas fa-newspaper text-warning me-2"></i>News</h6>
                        <span class="badge bg-warning">@Model.TotalNews</span>
                    </div>
                    <div class="progress mb-2" style="height: 8px;">
                        <div class="progress-bar bg-warning" role="progressbar" style="width: @Model.NewsPercentage.ToString("F1")%" aria-valuenow="@Model.NewsPercentage" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between text-muted small">
                        <span>@Model.NewsPercentage.ToString("F1")% of total</span>
                        <span>+@Model.NewNews new</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0"><i class="fas fa-book text-secondary me-2"></i>Guides</h6>
                        <span class="badge bg-secondary">@Model.TotalGuides</span>
                    </div>
                    <div class="progress mb-2" style="height: 8px;">
                        <div class="progress-bar bg-secondary" role="progressbar" style="width: @Model.GuidesPercentage.ToString("F1")%" aria-valuenow="@Model.GuidesPercentage" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between text-muted small">
                        <span>@Model.GuidesPercentage.ToString("F1")% of total</span>
                        <span>+@Model.NewGuides new</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h6 class="mb-0"><i class="fas fa-star text-danger me-2"></i>Reviews</h6>
                        <span class="badge bg-danger">@Model.TotalReviews</span>
                    </div>
                    <div class="progress mb-2" style="height: 8px;">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: @Model.ReviewsPercentage.ToString("F1")%" aria-valuenow="@Model.ReviewsPercentage" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="d-flex justify-content-between text-muted small">
                        <span>@Model.ReviewsPercentage.ToString("F1")% of total</span>
                        <span>+@Model.NewReviews new</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Performing Content -->
    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="fas fa-fire text-danger me-2"></i>Top Questions</h5>
                </div>
                <div class="card-body">
                    @if (Model.MostViewedQuestions.Any())
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var question in Model.MostViewedQuestions)
                            {
                                <div class="list-group-item px-0">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <a href="/Questions/Details/@question.Slug" target="_blank" class="text-decoration-none">
                                                <h6 class="mb-1">@question.Title</h6>
                                            </a>
                                            <small class="text-muted">
                                                by @question.AuthorName • @question.CreatedAt.ToString("MMM dd, yyyy")
                                            </small>
                                        </div>
                                        <div class="text-end ms-3">
                                            <span class="badge bg-primary">@question.ViewCount views</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4 text-muted">
                            <i class="fas fa-inbox fa-2x mb-2"></i>
                            <p class="mb-0">No questions yet</p>
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="mb-0"><i class="fas fa-fire text-danger me-2"></i>Top Posts</h5>
                </div>
                <div class="card-body">
                    @if (Model.MostViewedPosts.Any())
                    {
                        <div class="list-group list-group-flush">
                            @foreach (var post in Model.MostViewedPosts)
                            {
                                <div class="list-group-item px-0">
                                    <div class="d-flex justify-content-between align-items-start">
                                        <div class="flex-grow-1">
                                            <a href="/Post/Details/@post.Slug" target="_blank" class="text-decoration-none">
                                                <h6 class="mb-1">@post.Title</h6>
                                            </a>
                                            <small class="text-muted">
                                                by @post.AuthorName • @post.CreatedAt.ToString("MMM dd, yyyy")
                                            </small>
                                        </div>
                                        <div class="text-end ms-3">
                                            <span class="badge bg-success">@post.ViewCount views</span>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="text-center py-4 text-muted">
                            <i class="fas fa-inbox fa-2x mb-2"></i>
                            <p class="mb-0">No posts yet</p>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Content Growth Chart
        const growthCtx = document.getElementById('contentGrowthChart').getContext('2d');
        const monthlyData = @Html.Raw(Json.Serialize(Model.MonthlyGrowth));
        
        const labels = Object.keys(monthlyData);
        const questionsData = labels.map(key => monthlyData[key].questions);
        const postsData = labels.map(key => monthlyData[key].posts);
        const eventsData = labels.map(key => monthlyData[key].events);
        const newsData = labels.map(key => monthlyData[key].news);
        const guidesData = labels.map(key => monthlyData[key].guides);
        const reviewsData = labels.map(key => monthlyData[key].reviews);

        new Chart(growthCtx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'Questions',
                        data: questionsData,
                        borderColor: '#0d6efd',
                        backgroundColor: 'rgba(13, 110, 253, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Posts',
                        data: postsData,
                        borderColor: '#198754',
                        backgroundColor: 'rgba(25, 135, 84, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Events',
                        data: eventsData,
                        borderColor: '#0dcaf0',
                        backgroundColor: 'rgba(13, 202, 240, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'News',
                        data: newsData,
                        borderColor: '#ffc107',
                        backgroundColor: 'rgba(255, 193, 7, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Guides',
                        data: guidesData,
                        borderColor: '#6c757d',
                        backgroundColor: 'rgba(108, 117, 125, 0.1)',
                        tension: 0.4
                    },
                    {
                        label: 'Reviews',
                        data: reviewsData,
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        position: 'bottom'
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });

        // Content Distribution Pie Chart
        const distributionCtx = document.getElementById('contentDistributionChart').getContext('2d');
        new Chart(distributionCtx, {
            type: 'doughnut',
            data: {
                labels: ['Questions', 'Posts', 'Events', 'News', 'Guides', 'Reviews'],
                datasets: [{
                    data: [
                        @Model.TotalQuestions,
                        @Model.TotalPosts,
                        @Model.TotalEvents,
                        @Model.TotalNews,
                        @Model.TotalGuides,
                        @Model.TotalReviews
                    ],
                    backgroundColor: [
                        '#0d6efd',
                        '#198754',
                        '#0dcaf0',
                        '#ffc107',
                        '#6c757d',
                        '#dc3545'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed || 0;
                                const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                const percentage = ((value / total) * 100).toFixed(1);
                                return `${label}: ${value} (${percentage}%)`;
                            }
                        }
                    }
                }
            }
        });
    </script>
}
