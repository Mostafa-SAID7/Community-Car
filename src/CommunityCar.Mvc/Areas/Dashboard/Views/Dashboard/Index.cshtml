@model CommunityCar.Mvc.Areas.Dashboard.ViewModels.Dashboard.DashboardSummaryViewModel
@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

@{
    ViewData["Title"] = Localizer["Dashboard"];
}

<div class="dashboard-container">
    <!-- Dashboard Header -->
    <div class="dashboard-page-header">
        <div class="dashboard-header-content">
            <div class="dashboard-header-text">
                <h1 class="dashboard-title">@Localizer["Dashboard Overview"]</h1>
                <p class="dashboard-subtitle">@Localizer["Welcome back! Here's what's happening."]</p>
            </div>
            <div class="dashboard-header-actions">
                <button class="dashboard-btn dashboard-btn-secondary" onclick="location.reload()">
                    <i class="fas fa-sync-alt"></i>
                    <span>@Localizer["Refresh"]</span>
                </button>
                <div class="dashboard-dropdown">
                    <button type="button" class="dashboard-btn dashboard-btn-primary" data-bs-toggle="dropdown">
                        <i class="fas fa-download"></i>
                        <span>@Localizer["Export"]</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <ul class="dashboard-dropdown-menu">
                        <li><a class="dashboard-dropdown-item" href="@Url.Action("ExportReport", new { format = "csv" })">
                            <i class="fas fa-file-csv"></i>CSV
                        </a></li>
                        <li><a class="dashboard-dropdown-item" href="@Url.Action("ExportReport", new { format = "json" })">
                            <i class="fas fa-file-code"></i>JSON
                        </a></li>
                        <li><a class="dashboard-dropdown-item" href="@Url.Action("ExportReport", new { format = "pdf" })">
                            <i class="fas fa-file-pdf"></i>PDF
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Navigation Tabs -->
    <div class="dashboard-nav-tabs">
        <div class="dashboard-tabs-container">
            <a href="@Url.Action("Index", "Dashboard", new { area = "Dashboard" })" 
               class="dashboard-tab @(ViewContext.RouteData.Values["controller"]?.ToString() == "Dashboard" && ViewContext.RouteData.Values["action"]?.ToString() == "Index" ? "active" : "")">
                <i class="fas fa-chart-line"></i>
                <span>@Localizer["Overview"]</span>
            </a>
            <a href="@Url.Action("Index", "KPIs", new { area = "Dashboard" })" 
               class="dashboard-tab @(ViewContext.RouteData.Values["controller"]?.ToString() == "KPIs" ? "active" : "")">
                <i class="fas fa-chart-bar"></i>
                <span>@Localizer["KPIs"]</span>
            </a>
            <a href="@Url.Action("Index", "Trends", new { area = "Dashboard" })" 
               class="dashboard-tab @(ViewContext.RouteData.Values["controller"]?.ToString() == "Trends" ? "active" : "")">
                <i class="fas fa-chart-area"></i>
                <span>@Localizer["Trends"]</span>
            </a>
            <a href="@Url.Action("Index", "Widgets", new { area = "Dashboard" })" 
               class="dashboard-tab @(ViewContext.RouteData.Values["controller"]?.ToString() == "Widgets" ? "active" : "")">
                <i class="fas fa-th"></i>
                <span>@Localizer["Widgets"]</span>
            </a>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="dashboard-stats-grid">
        <div class="dashboard-stat-card dashboard-stat-card-primary">
            <div class="dashboard-stat-content">
                <div class="dashboard-stat-icon dashboard-stat-icon-primary">
                    <i class="fas fa-users"></i>
                </div>
                <div class="dashboard-stat-info">
                    <div class="dashboard-stat-label">@Localizer["Total Users"]</div>
                    <div class="dashboard-stat-value">@Model.TotalUsers.ToString("N0")</div>
                    <div class="dashboard-stat-change dashboard-stat-change-positive">
                        <i class="fas fa-arrow-up"></i>@Model.UserGrowthPercentage.ToString("F1")% @Localizer["from last month"]
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-stat-card dashboard-stat-card-success">
            <div class="dashboard-stat-content">
                <div class="dashboard-stat-icon dashboard-stat-icon-success">
                    <i class="fas fa-user-friends"></i>
                </div>
                <div class="dashboard-stat-info">
                    <div class="dashboard-stat-label">@Localizer["Friendships"]</div>
                    <div class="dashboard-stat-value">@Model.TotalFriendships.ToString("N0")</div>
                    <div class="dashboard-stat-change dashboard-stat-change-positive">
                        <i class="fas fa-arrow-up"></i>8% @Localizer["from last month"]
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-stat-card dashboard-stat-card-warning">
            <div class="dashboard-stat-content">
                <div class="dashboard-stat-icon dashboard-stat-icon-warning">
                    <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="dashboard-stat-info">
                    <div class="dashboard-stat-label">@Localizer["Active Events"]</div>
                    <div class="dashboard-stat-value">@Model.ActiveEvents.ToString("N0")</div>
                    <div class="dashboard-stat-change dashboard-stat-change-info">
                        <i class="fas fa-calendar"></i>@Localizer["This month"]
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard-stat-card dashboard-stat-card-info">
            <div class="dashboard-stat-content">
                <div class="dashboard-stat-icon dashboard-stat-icon-info">
                    <i class="fas fa-heart-pulse"></i>
                </div>
                <div class="dashboard-stat-info">
                    <div class="dashboard-stat-label">@Localizer["System Health"]</div>
                    <div class="dashboard-stat-value">@Model.SystemHealth%</div>
                    <div class="dashboard-stat-change dashboard-stat-change-positive">
                        <i class="fas fa-check-circle"></i>@Localizer["All systems operational"]
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Additional Metrics Row -->
    <div class="dashboard-metrics-grid">
        <div class="dashboard-metric-card dashboard-metric-card-primary">
            <div class="dashboard-metric-label">@Localizer["Total Posts"]</div>
            <div class="dashboard-metric-value">@Model.TotalPosts.ToString("N0")</div>
        </div>
        <div class="dashboard-metric-card dashboard-metric-card-info">
            <div class="dashboard-metric-label">@Localizer["Questions"]</div>
            <div class="dashboard-metric-value">@Model.TotalQuestions.ToString("N0")</div>
        </div>
        <div class="dashboard-metric-card dashboard-metric-card-success">
            <div class="dashboard-metric-label">@Localizer["Groups"]</div>
            <div class="dashboard-metric-value">@Model.TotalGroups.ToString("N0")</div>
        </div>
        <div class="dashboard-metric-card dashboard-metric-card-warning">
            <div class="dashboard-metric-label">@Localizer["Reviews"]</div>
            <div class="dashboard-metric-value">@Model.TotalReviews.ToString("N0")</div>
        </div>
        <div class="dashboard-metric-card dashboard-metric-card-danger">
            <div class="dashboard-metric-label">@Localizer["Guides"]</div>
            <div class="dashboard-metric-value">@Model.TotalGuides.ToString("N0")</div>
        </div>
        <div class="dashboard-metric-card dashboard-metric-card-secondary">
            <div class="dashboard-metric-label">@Localizer["News"]</div>
            <div class="dashboard-metric-value">@Model.TotalNews.ToString("N0")</div>
        </div>
    </div>

    <div class="dashboard-content-grid">
        <!-- Left Column: Charts and Activity -->
        <div class="dashboard-content-main">
            <!-- Weekly Activity Chart -->
            <div class="dashboard-card dashboard-card-primary">
                <div class="dashboard-card-header">
                    <h5 class="dashboard-card-title">@Localizer["Weekly Activity"]</h5>
                    <div class="dashboard-btn-group">
                        <button type="button" class="dashboard-btn-group-item active">@Localizer["Week"]</button>
                        <button type="button" class="dashboard-btn-group-item">@Localizer["Month"]</button>
                        <button type="button" class="dashboard-btn-group-item">@Localizer["Year"]</button>
                    </div>
                </div>
                <div class="dashboard-card-body">
                    <canvas id="activityChart" height="80"></canvas>
                </div>
            </div>

            <!-- User Growth Trend Chart -->
            <div class="dashboard-card dashboard-card-success">
                <div class="dashboard-card-header">
                    <h5 class="dashboard-card-title">@Localizer["User Growth Trend"]</h5>
                </div>
                <div class="dashboard-card-body">
                    <canvas id="growthChart" height="80"></canvas>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="dashboard-card dashboard-card-warning">
                <div class="dashboard-card-header">
                    <h5 class="dashboard-card-title">@Localizer["Recent Activity"]</h5>
                    <a asp-area="Dashboard" asp-controller="AuditLogs" asp-action="Index" class="dashboard-btn dashboard-btn-sm dashboard-btn-danger">
                        @Localizer["View All"]
                    </a>
                </div>
                <div class="dashboard-card-body">
                    <div class="dashboard-table-wrapper">
                        <table class="dashboard-table">
                            <thead>
                                <tr>
                                    <th>@Localizer["Time"]</th>
                                    <th>@Localizer["User"]</th>
                                    <th>@Localizer["Action"]</th>
                                    <th>@Localizer["Status"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><span class="dashboard-table-time">@DateTime.Now.AddMinutes(-5).ToString("HH:mm")</span></td>
                                    <td>Admin User</td>
                                    <td>Updated system settings</td>
                                    <td><span class="dashboard-badge dashboard-badge-success">Success</span></td>
                                </tr>
                                <tr>
                                    <td><span class="dashboard-table-time">@DateTime.Now.AddMinutes(-15).ToString("HH:mm")</span></td>
                                    <td>System</td>
                                    <td>Database backup completed</td>
                                    <td><span class="dashboard-badge dashboard-badge-info">Info</span></td>
                                </tr>
                                <tr>
                                    <td><span class="dashboard-table-time">@DateTime.Now.AddMinutes(-30).ToString("HH:mm")</span></td>
                                    <td>Admin User</td>
                                    <td>Created new user account</td>
                                    <td><span class="dashboard-badge dashboard-badge-success">Success</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Widgets -->
        <div class="dashboard-content-sidebar">
            <!-- Content Distribution Chart -->
            <div class="dashboard-card dashboard-card-primary">
                <div class="dashboard-card-header">
                    <h5 class="dashboard-card-title">@Localizer["Content Distribution"]</h5>
                </div>
                <div class="dashboard-card-body">
                    <canvas id="contentChart" height="200"></canvas>
                </div>
            </div>

            <!-- Engagement Metrics Chart -->
            <div class="dashboard-card dashboard-card-warning">
                <div class="dashboard-card-header">
                    <h5 class="dashboard-card-title">@Localizer["Engagement Metrics"]</h5>
                </div>
                <div class="dashboard-card-body">
                    <canvas id="engagementChart" height="200"></canvas>
                    <div class="dashboard-progress-wrapper">
                        <div class="dashboard-progress-header">
                            <span class="dashboard-progress-label">@Localizer["Engagement Rate"]</span>
                            <span class="dashboard-progress-value">@Model.EngagementRate.ToString("F1")%</span>
                        </div>
                        <div class="dashboard-progress">
                            <div class="dashboard-progress-bar dashboard-progress-bar-success" style="width: @Model.EngagementRate%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="dashboard-card dashboard-card-info">
                <div class="dashboard-card-header">
                    <h5 class="dashboard-card-title">@Localizer["System Status"]</h5>
                </div>
                <div class="dashboard-card-body">
                    <div class="dashboard-status-item">
                        <div class="dashboard-status-header">
                            <span class="dashboard-status-label">@Localizer["Database"]</span>
                            <span class="dashboard-status-value dashboard-status-value-success">@Localizer["Online"]</span>
                        </div>
                        <div class="dashboard-progress">
                            <div class="dashboard-progress-bar dashboard-progress-bar-success" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="dashboard-status-item">
                        <div class="dashboard-status-header">
                            <span class="dashboard-status-label">@Localizer["API Services"]</span>
                            <span class="dashboard-status-value dashboard-status-value-success">@Localizer["Running"]</span>
                        </div>
                        <div class="dashboard-progress">
                            <div class="dashboard-progress-bar dashboard-progress-bar-success" style="width: 100%"></div>
                        </div>
                    </div>
                    <div class="dashboard-status-item">
                        <div class="dashboard-status-header">
                            <span class="dashboard-status-label">@Localizer["Cache"]</span>
                            <span class="dashboard-status-value dashboard-status-value-success">@Localizer["Active"]</span>
                        </div>
                        <div class="dashboard-progress">
                            <div class="dashboard-progress-bar dashboard-progress-bar-success" style="width: 100%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="dashboard-card dashboard-card-success">
                <div class="dashboard-card-header">
                    <h5 class="dashboard-card-title">@Localizer["Quick Actions"]</h5>
                </div>
                <div class="dashboard-card-body">
                    <div class="dashboard-actions-list">
                        <a asp-area="Dashboard" asp-controller="UserManagement" asp-action="Index" class="dashboard-action-item dashboard-action-item-danger">
                            <i class="fas fa-users"></i>
                            <span>@Localizer["Manage Users"]</span>
                        </a>
                        <a asp-area="Dashboard" asp-controller="ContentManagement" asp-action="Index" class="dashboard-action-item dashboard-action-item-success">
                            <i class="fas fa-layer-group"></i>
                            <span>@Localizer["Manage Content"]</span>
                        </a>
                        <a asp-area="Dashboard" asp-controller="UserReports" asp-action="Index" class="dashboard-action-item dashboard-action-item-info">
                            <i class="fas fa-chart-bar"></i>
                            <span>@Localizer["View Reports"]</span>
                        </a>
                        <a asp-area="Dashboard" asp-controller="Security" asp-action="Index" class="dashboard-action-item dashboard-action-item-warning">
                            <i class="fas fa-shield-halved"></i>
                            <span>@Localizer["Security Alerts"]</span>
                        </a>
                        <a asp-area="Dashboard" asp-controller="Settings" asp-action="Index" class="dashboard-action-item dashboard-action-item-secondary">
                            <i class="fas fa-cog"></i>
                            <span>@Localizer["System Settings"]</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        // Activity Chart (Line)
        const activityCtx = document.getElementById('activityChart');
        const activityData = @Html.Raw(Json.Serialize(ViewBag.ActivityData ?? new List<int>()));
        const activityLabels = @Html.Raw(Json.Serialize(ViewBag.ActivityLabels ?? new List<string>()));

        new Chart(activityCtx, {
            type: 'line',
            data: {
                labels: activityLabels,
                datasets: [{
                    label: '@Localizer["User Registrations"]',
                    data: activityData,
                    borderColor: 'rgb(75, 192, 192)',
                    backgroundColor: 'rgba(75, 192, 192, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });

        // User Growth Trend Chart (Area)
        const growthCtx = document.getElementById('growthChart');
        const growthData = @Html.Raw(Json.Serialize(ViewBag.GrowthData ?? new List<int>()));
        const growthLabels = @Html.Raw(Json.Serialize(ViewBag.GrowthLabels ?? new List<string>()));

        new Chart(growthCtx, {
            type: 'line',
            data: {
                labels: growthLabels,
                datasets: [{
                    label: '@Localizer["Total Users"]',
                    data: growthData,
                    borderColor: 'rgb(34, 197, 94)',
                    backgroundColor: 'rgba(34, 197, 94, 0.2)',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointHoverRadius: 7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });

        // Content Distribution Chart (Doughnut)
        const contentCtx = document.getElementById('contentChart');
        const contentData = @Html.Raw(Json.Serialize(ViewBag.ContentData ?? new List<int>()));
        const contentLabels = @Html.Raw(Json.Serialize(ViewBag.ContentLabels ?? new List<string>()));

        new Chart(contentCtx, {
            type: 'doughnut',
            data: {
                labels: contentLabels,
                datasets: [{
                    data: contentData,
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(251, 44, 54, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(34, 197, 94, 0.8)',
                        'rgba(168, 85, 247, 0.8)'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'bottom'
                    }
                }
            }
        });

        // Engagement Metrics Chart (Bar)
        const engagementCtx = document.getElementById('engagementChart');
        const engagementData = @Html.Raw(Json.Serialize(ViewBag.EngagementData ?? new List<int>()));
        const engagementLabels = @Html.Raw(Json.Serialize(ViewBag.EngagementLabels ?? new List<string>()));

        new Chart(engagementCtx, {
            type: 'bar',
            data: {
                labels: engagementLabels,
                datasets: [{
                    label: '@Localizer["Interactions"]',
                    data: engagementData,
                    backgroundColor: [
                        'rgba(59, 130, 246, 0.8)',
                        'rgba(34, 197, 94, 0.8)',
                        'rgba(251, 44, 54, 0.8)',
                        'rgba(245, 158, 11, 0.8)',
                        'rgba(168, 85, 247, 0.8)'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: true,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            precision: 0
                        }
                    }
                }
            }
        });
    </script>
}

@section Styles {
    <link rel="stylesheet" href="~/css/pages/dashboard.css" asp-append-version="true" />
}
