@model CommunityCar.Domain.Base.PagedResult<CommunityCar.Domain.DTOs.Community.QuestionDto>

@{
    var currentTag = ViewBag.CurrentTag as string;
    var isResolved = ViewBag.IsResolved as bool?;
    var sortBy = ViewBag.SortBy as string ?? "recent";
    var searchTerm = ViewBag.SearchTerm as string;
}

@if (Model.Items.Any())
{
    foreach (var question in Model.Items)
    {
        <div class="question-card card" data-question-id="@question.Id">
            <div class="card-body p-3">
                <div class="question-card-enhanced">
                    <!-- Stats Column -->
                    <div class="question-stats-enhanced">
                        <div class="stat-box votes">
                            <span class="stat-value">@question.VoteCount</span>
                            <span class="stat-label">@Localizer["Votes"]</span>
                        </div>
                        <div class="stat-box answers @(question.IsResolved ? "accepted" : (question.AnswerCount > 0 ? "has-answers" : ""))">
                            <span class="stat-value">@question.AnswerCount</span>
                            <span class="stat-label">@Localizer["Answers"]</span>
                        </div>
                        <div class="stat-box views">
                            <span class="stat-value">@question.ViewCount</span>
                            <span class="stat-label">@Localizer["Views"]</span>
                        </div>
                    </div>

                    <!-- Main Content -->
                    <div class="question-main">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                             <a asp-action="Details" asp-route-slug="@question.Slug" class="question-title mb-0 text-decoration-none">
                                @question.Title
                            </a>
                        </div>
                        
                        <p class="question-excerpt mb-2 text-muted small">
                            @(question.Content.Length > 160 ? question.Content.Substring(0, 160) + "..." : question.Content)
                        </p>

                        <!-- Tags -->
                         @if (!string.IsNullOrEmpty(question.Tags))
                        {
                            <div class="question-tags mb-2">
                                @foreach (var tag in question.Tags.Split(',', StringSplitOptions.RemoveEmptyEntries))
                                {
                                    <a asp-action="Index" asp-route-tag="@tag.Trim()" class="badge bg-light text-secondary fw-normal border text-decoration-none">@tag.Trim()</a>
                                }
                            </div>
                        }

                        <!-- Metadata Row -->
                        <div class="question-meta-enhanced">
                             @if (question.IsResolved)
                            {
                                <div class="resolved-status">
                                    <i class="fas fa-check-circle"></i> @Localizer["Resolved"]
                                </div>
                            }
                            
                            <div class="meta-item">
                                <a asp-area="Identity" asp-controller="Profiles" asp-action="Index" asp-route-userId="@question.AuthorId" class="author-mini text-decoration-none">
                                    <img src="@(question.AuthorProfilePicture ?? $"https://ui-avatars.com/api/?name={question.AuthorName}&background=random")" 
                                         alt="@question.AuthorName" />
                                    <span>@question.AuthorName</span>
                                </a>
                                <span class="text-muted">asked @question.CreatedAt.ToTimeAgo()</span>
                            </div>

                             @if (question.Category != null)
                             {
                                 <div class="meta-item ms-auto">
                                     <a asp-action="Index" asp-route-categoryId="@question.Category.Id" class="text-muted text-decoration-none">
                                         in <strong>@question.Category.Name</strong>
                                     </a>
                                 </div>
                             }
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Pagination -->
    @if (Model.TotalPages > 1)
    {
        <nav aria-label="Questions pagination" class="mt-4">
            <ul class="pagination justify-content-center">
                <li class="page-item @(Model.PageNumber == 1 ? "disabled" : "")">
                    <a class="page-link" href="#" data-page="@(Model.PageNumber - 1)">
                        <i class="fas fa-chevron-left me-1"></i>@Localizer["Previous"]
                    </a>
                </li>
                
                @for (int i = Math.Max(1, Model.PageNumber - 2); i <= Math.Min(Model.TotalPages, Model.PageNumber + 2); i++)
                {
                    <li class="page-item @(i == Model.PageNumber ? "active" : "")">
                        <a class="page-link" href="#" data-page="@i">
                            @i
                        </a>
                    </li>
                }
                
                <li class="page-item @(Model.PageNumber == Model.TotalPages ? "disabled" : "")">
                    <a class="page-link" href="#" data-page="@(Model.PageNumber + 1)">
                        @Localizer["Next"]<i class="fas fa-chevron-right ms-1"></i>
                    </a>
                </li>
            </ul>
        </nav>
    }
}
else
{
    <div class="empty-state">
        <div class="mb-4">
            <i class="fas fa-search fa-3x text-muted opacity-50"></i>
        </div>
        <h4 class="mb-2">@Localizer["No Questions Found"]</h4>
        <p class="text-muted mb-4">
            @if (!string.IsNullOrEmpty(currentTag) || isResolved.HasValue || !string.IsNullOrEmpty(searchTerm))
            {
                <span>@Localizer["Try adjusting your filters or search terms to find what you're looking for."]</span>
            }
            else
            {
                <span>@Localizer["Be the first to ask a question in this community!"]</span>
            }
        </p>
        <a href="@Url.Action("Create")" class="btn btn-primary rounded-pill px-4 py-2">
            <i class="fas fa-plus-circle me-2"></i>@Localizer["Ask a Question"]
        </a>
    </div>
}
