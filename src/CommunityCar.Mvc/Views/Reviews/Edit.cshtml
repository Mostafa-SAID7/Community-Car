@model CommunityCar.Mvc.ViewModels.Reviews.EditReviewViewModel

@{
    ViewData["Title"] = "Edit Review";

    ViewData["HeaderTitle"] = "Edit Review";
    ViewData["HeaderDescription"] = "Update your feedback and rating";
    ViewData["HeaderIcon"] = "fas fa-star-half-alt";
}

@section Styles {
    <style>
        .star-rating-input {
            display: flex;
            flex-direction: row-reverse;
            justify-content: flex-end;
            gap: 0.5rem;
        }
        .star-rating-input input {
            display: none;
        }
        .star-rating-input label {
            font-size: 2rem;
            color: #edf2f7;
            cursor: pointer;
            transition: color 0.2s;
        }
        .star-rating-input label:hover,
        .star-rating-input label:hover ~ label,
        .star-rating-input input:checked ~ label {
            color: #f6ad55;
        }
        .pro-con-input {
            border-radius: 12px;
            border: 2px solid #edf2f7;
            padding: 1rem;
            transition: all 0.2s;
        }
        .pro-con-input:focus-within {
            border-color: #667eea;
            background: #fff;
        }
    </style>
}

<partial name="_InnerPageHeader" />

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-action="Index">Reviews</a></li>
                    <li class="breadcrumb-item active">Edit Review</li>
                </ol>
            </nav>

            <div class="card shadow-sm border-0 rounded-4">
                <div class="card-body p-4 p-md-5">
                    <form asp-action="Edit" method="post">
                        <input type="hidden" asp-for="Id" />
                        <div asp-validation-summary="ModelOnly" class="alert alert-danger rounded-4"></div>

                        <div class="mb-5 text-center">
                            <label class="form-label fw-bold mb-3 d-block">Overall Rating <span class="text-danger">*</span></label>
                            <div class="star-rating-input justify-content-center">
                                @for (int i = 5; i >= 1; i--)
                                {
                                    <input type="radio" asp-for="Rating" value="@i" id="star@i" />
                                    <label for="star@i"><i class="fas fa-star"></i></label>
                                }
                            </div>
                            <span asp-validation-for="Rating" class="text-danger d-block mt-2"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="Title" class="form-label fw-bold">Review Headline <span class="text-danger">*</span></label>
                            <input asp-for="Title" class="form-control form-control-lg rounded-3" placeholder="Summarize your experience" />
                            <span asp-validation-for="Title" class="text-danger"></span>
                        </div>

                        <div class="mb-4">
                            <label asp-for="Content" class="form-label fw-bold">Review Details <span class="text-danger">*</span></label>
                            <textarea asp-for="Content" class="form-control rounded-3" rows="8" placeholder="Tell the community what you think... Minimum 50 characters.">@Model.Content</textarea>
                            <span asp-validation-for="Content" class="text-danger"></span>
                        </div>

                        <div class="row g-4 mb-4">
                            <div class="col-md-6">
                                <label asp-for="Pros" class="form-label fw-bold text-success"><i class="fas fa-plus-circle me-1"></i>Pros</label>
                                <textarea asp-for="Pros" class="form-control pro-con-input" rows="4" placeholder="What did you like? (one per line)">@Model.Pros</textarea>
                                <span asp-validation-for="Pros" class="text-danger"></span>
                            </div>
                            <div class="col-md-6">
                                <label asp-for="Cons" class="form-label fw-bold text-danger"><i class="fas fa-minus-circle me-1"></i>Cons</label>
                                <textarea asp-for="Cons" class="form-control pro-con-input" rows="4" placeholder="What could be better? (one per line)">@Model.Cons</textarea>
                                <span asp-validation-for="Cons" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="mb-5">
                            <div class="form-check form-switch p-3 bg-light rounded-4 d-flex align-items-center">
                                <input asp-for="IsRecommended" class="form-check-input ms-0 me-3" type="checkbox" style="width: 3rem; height: 1.5rem;">
                                <label asp-for="IsRecommended" class="form-check-label fw-bold">
                                    I recommend this to the community
                                </label>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between align-items-center pt-4 border-top">
                            <a asp-action="Index" class="text-muted text-decoration-none">
                                <i class="fas fa-arrow-left me-1"></i>Back to Reviews
                            </a>
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-outline-danger rounded-pill px-4" onclick="deleteReview('@Model.Id')">
                                    <i class="fas fa-trash-alt me-2"></i>Delete
                                </button>
                                <button type="submit" class="btn btn-primary rounded-pill px-5">
                                    <i class="fas fa-check-circle me-2"></i>Apply Changes
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        function deleteReview(id) {
            Swal.fire({
                title: 'Delete Review?',
                text: "This action cannot be undone.",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it'
            }).then((result) => {
                if (result.isConfirmed) {
                    $.post('/Reviews/Delete/' + id, { __RequestVerificationToken: $('input[name="__RequestVerificationToken"]').val() }, function(res) {
                        if (res.success) window.location.href = '/Reviews';
                    });
                }
            });
        }
    </script>
}
