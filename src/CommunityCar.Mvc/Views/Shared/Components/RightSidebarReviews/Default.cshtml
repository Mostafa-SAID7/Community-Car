@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer
@model CommunityCar.Mvc.ViewModels.Community.SidebarReviewsViewModel

<!-- Write Review Action -->
<div class="d-grid mb-4">
    <a asp-controller="Reviews" asp-action="Create" class="btn btn-primary btn-lg rounded-pill shadow-sm">
        <i class="fas fa-star me-2"></i> @Localizer["Write Review"]
    </a>
</div>

<!-- Recent Reviews Widget -->
<div class="card border-0 shadow-sm mb-4 rounded-4">
    <div class="card-body">
        <h6 class="card-title fw-bold mb-3">@Localizer["Recent Reviews"]</h6>
        <div class="vstack gap-3">
            @if (Model.RecentReviews != null && Model.RecentReviews.Any())
            {
                foreach (var review in Model.RecentReviews)
                {
                    <div>
                        <a asp-controller="Reviews" asp-action="Details" asp-route-slug="@review.Slug" class="text-decoration-none text-dark fw-bold small d-block mb-1">@review.Title</a>
                        <div class="d-flex align-items-center text-xs text-muted">
                            <div class="star-rating me-2">
                                @for (int i = 1; i <= 5; i++)
                                {
                                    <i class="fas fa-star star @(i <= review.Rating ? "filled" : "empty")"></i>
                                }
                            </div>
                            <span>@review.CreatedAt.ToTimeAgo()</span>
                        </div>
                    </div>
                    @if (review != Model.RecentReviews.Last())
                    {
                        <hr class="m-0 text-muted opacity-25">
                    }
                }
            }
            else
            {
                <div class="text-muted small">@Localizer["No recent reviews"]</div>
            }
        </div>
    </div>
</div>

<!-- Top Reviews Widget -->
<div class="card border-0 shadow-sm mb-4 rounded-4">
    <div class="card-body">
        <h6 class="card-title fw-bold mb-3">@Localizer["Top Rated"]</h6>
        <div class="vstack gap-3">
            @if (Model.TopReviews != null && Model.TopReviews.Any())
            {
                foreach (var review in Model.TopReviews)
                {
                    <div>
                        <a asp-controller="Reviews" asp-action="Details" asp-route-slug="@review.Slug" class="text-decoration-none text-dark fw-bold small d-block mb-1">@review.Title</a>
                        <div class="metadata-text">
                            <i class="fas fa-thumbs-up me-1"></i>
                            <span>@review.HelpfulCount @Localizer["helpful"]</span>
                        </div>
                    </div>
                    @if (review != Model.TopReviews.Last())
                    {
                        <hr class="m-0 text-muted opacity-25">
                    }
                }
            }
            else
            {
                <div class="text-muted small">@Localizer["No top reviews"]</div>
            }
        </div>
    </div>
</div>
