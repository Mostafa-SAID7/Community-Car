@model CommunityCar.Mvc.ViewModels.Qa.CreateCommentViewModel

<div class="comment-form-container">
    @if (User.Identity?.IsAuthenticated == true)
    {
        <form asp-controller="Comments" asp-action="Create" method="post" class="comment-form" data-answer-id="@Model.AnswerId">
            @Html.AntiForgeryToken()
            <input type="hidden" asp-for="QuestionId" />
            <input type="hidden" asp-for="AnswerId" />
            
            <div class="mb-3">
                <label asp-for="Content" class="form-label">Add a comment</label>
                <textarea asp-for="Content" 
                          class="form-control" 
                          rows="3" 
                          placeholder="Share your thoughts..."
                          maxlength="1000"></textarea>
                <span asp-validation-for="Content" class="text-danger"></span>
                <small class="form-text text-muted">
                    <span class="char-count">0</span> / 1000 characters
                </small>
            </div>
            
            <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn btn-sm btn-secondary cancel-comment-btn d-none">
                    Cancel
                </button>
                <button type="submit" class="btn btn-sm btn-primary">
                    <i class="fas fa-paper-plane me-1"></i> Post Comment
                </button>
            </div>
        </form>
    }
    else
    {
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            Please <a asp-area="Identity" asp-controller="Account" asp-action="Login" asp-route-returnUrl="@Context.Request.Path">sign in</a> to comment.
        </div>
    }
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            // Character counter
            $('.comment-form textarea').on('input', function() {
                const length = $(this).val().length;
                $(this).closest('.comment-form').find('.char-count').text(length);
            });
            
            // Show/hide cancel button
            $('.comment-form textarea').on('focus', function() {
                $(this).closest('.comment-form').find('.cancel-comment-btn').show();
            });
            
            $('.cancel-comment-btn').on('click', function() {
                const form = $(this).closest('.comment-form');
                form.find('textarea').val('').blur();
                form.find('.char-count').text('0');
                $(this).hide();
            });
        });
    </script>
}
